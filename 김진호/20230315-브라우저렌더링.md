# 브라우저의 주요 기능
브라우저의 주요 기능은 사용자가 선택한 자원을 서버에 요청하고 브라우저에 표시하는 것.
자원의 주소는 URI(Uniform Resource Identifier)에 의해 정해진다.

# 브라우저의 기본 구조

1. 사용자 인터페이스 - 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분
2. 브라우저 엔진 - 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어
3. 렌더링 엔진 - 요청한 콘텐츠를 표시. 예를 들어 HTML을 요청하면 HTML과 CSS를 파싱하여 화면에 표시함.
4. 통신 - HTTP 요청과 같은 네트워크 호출에 사용됨. 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행
5. UI 백엔드 - 콤보 받스와 창 같은 기본적인 장치를 그림. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용
6. 자바스크립트 해석기 - 자바스크립트 코드를 해석하고 실행
7. 자료 저상소 - 자료를 저장하는 계층. 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드디스크에 저장할 필요가 있다.

<p align="left">
<img width="500" alt="화면 캡처 2023-03-13 221806" src="https://user-images.githubusercontent.com/37106496/224713404-b8f0b493-c833-4471-b6fa-a93e9d9337dd.png">
</p>


## 렌더링 엔진
렌더링 엔진의 역할은 요청 받은 내용을 브라우저 화면에 표시하는 일이다.

### 동작 과정
렌더링 엔진은 동팃으로부터 요청한 문서의 내용을 얻는 것으로 시작하는데 문서의 내용은 보통 8KB 단위로 전송됨

<img width="700" alt="화면 캡처 2023-03-13 222909" src="https://user-images.githubusercontent.com/37106496/224715926-1e13234b-bfd1-442a-8e72-3fd4829a6ddd.png">

<br/> 

-  렌더링 엔진은 HTML문서를 파싱하고 "콘텐츠 트리" 내부에서 태그를 DOM노드로 변환하고 외부 CSS파일과 함께 포함된 스타일 요소도 파싱함. 스타일 정보와 HTML 표시 규칙은 "렌더 트리"라고 부르는 또 다른 트리를 생성함.
-  렌더 트리는 색상 또는 면적과 같은 시각적 속성이 있는 사각형을 포함하고 있고 정해진 순서대로 화면에 표시함.
-  렌더 트리 생성이 끝나면 노드가 정확한 위치에 표시되기 위한 배치작업이 시작됨. 


## 브라우저 렌더링 동작 과정
1. HTML파일과 CSS파일을 파싱해서 각각 Tree를 만듬 **(Parsing)** 
2. 두 Tree를 결합하여 Rendering Tree를 만든다.  **(Style)** 
3. Rendering Tree에서 각 노드의 위치와 크기를 계산한다. **(Layout)**
4. 계산된 값을 이용해 각 노드를 화면상의 실제 픽셀로 변환하고, 레이어를 만든다. **(Paint)**
5. 레이어를 합성하여 실제 화면에 나타낸다.  **(Composite)**

### Parsing
브라우저가 페이지를 렌더링하려면 가장 먼저 받아온 HTML파일을 해석해야한다. Parsing단계는 HTML파일을 해석하여 DOM(Document Object Model) Tree를 구성하는 단계이다.
파싱 중 HTML에 CSS가 포함되어 있다면 CSSOM(CSS Object Model) Tree 구성작업도 함께 진행한다.

### Style
Style 단계에서는 Parsing단계에서 생성된 DOM Tree와 CSSOM Tree를 매칭시켜서 Render Tree를 구성한다. Render Tree는 실제로 화면에 그려질 Tree이다.

### Layout
Layout 단계에서는 Render Tree를 화면에 어떻게 배치해야 할 것인기 노드의 정확환 위치와 크기를 계산한다.     
     
루트부터 노드를 순회하면서 노드의 정확한 크기와 위치를 계산하고 Render Tree에 반영함.     
만약 크기 값을 %로 지정하였다면, Layout 단계에서 %값을 계산해서 픽셀 단위로 변환한다.

### Paint
Paint 단계에서는 Layout 단계에서 계산된 값을 이용해 Render Tree의 각 노드를 화면상의 실제 픽셀로 변환한다.     
이때 픽셀로 변환된 결과는 하나의 레이어가 아니라 여러 개의 레이어로 관리된다.

### Composite
Composite 단계에서는 Paint단계에서 생성된 레이어를 합성하여 실제 화면에 나타낸다.
여기서 우리는 화면에서 웹페이지를 볼 수 있다.


![helloworld-59361-3](https://user-images.githubusercontent.com/37106496/224717738-30ce8d49-76c0-403d-9128-8fbe8cfe9f3c.png)


  

# 파싱과 DOM트리 구축
**문서 파싱은 브라우저가 코드를 이해라고 사용할 수 있는 구조로 변환하는 것을 의미함.**  
파싱 결과는 보통 문서 구조를 나타내는 노드 트리인데 파싱 트리(parse tree)또는 문법 트리(syntax tree)라고 부른다.

## 문법
파싱은 문서에 작성된 언어 또는 형식의 규칙에 따르는데 파싱할 수 있는 모든 형식은 정해진 용어와 구분 규칙에 따라야 한다. 이것을 문맥 자유 문법이라고함.

## 파서-어휘 분석기 조합
파싱은 어휘 분석과 구문 분석이라는 두 가지로 구분할 수 있다.  

**어휘분석** : 자료를 토큰으로 분해하는 과정. 토큰은 유효하게 구성된 단위의 집합체로 용어집이라고도 할 수 있는데 사전에 등장하는 모든 단어에 해당된다.  
  
**구문 분석** : 언어의 구문 규칙을 적용하는 과정.  

파서는 보통 두 가지 일을 하는데 자료를 유효한 토큰으로 분해하는 어휘 분석기가 있고 언어 구문 규칙에 따라 문서 구조를 분석함으로써 파싱 트리를 생성하는 파서가 있다. 어휘 분석기는 공백과 줄 바꾼 같은 의미없는 문자를 제거한다.  

<p align="center">
<img width="150" alt="화면 캡처 2023-03-13 225613" src="https://user-images.githubusercontent.com/37106496/224723031-42de6c79-a456-4838-850b-e6d1ab185ebe.png">
</p>

파싱 과정은 반복되며, 파서는 어휘 분석기로부터 새 토큰을 받아서 구문 규칙과 일치하는지 확인한다.

## DOM
"파싱 트리"는 DOM요소와 속성 노드의 트리로서 출력 트리가 된다. DOM은 문서 객체모델(Document Object Model)의 준말.
이것은 HTML문서의 객체 표현이고 외부를 향하는 자바스크립트와 같은 HTML 요소의 연결 지점이다.